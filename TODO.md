# خطة تنفيذية لإصلاح وتحديث المشروع

## أولويات عالية (يجب تنفيذها فوراً)

### 1. تنفيذ التحقق الصارم لملفات Excel عند الاستيراد
- [x] تعريف مخطط JSON لكل جدول (purchases, Sales, Physical_Inventory, supplierbalances)
- [x] إنشاء مكتبة تحقق قابلة للتشغيل قبل المعالجة
- [x] تنفيذ التحقق من صحة المخطط مع رسائل خطأ واضحة

### 2. إكمال منطق NetPurchases وNetSales وفق المفاتيح العشرة
- [x] تنفيذ المفاتيح العشرة المذكورة في المستند لكل من NetPurchases وNetSales
- [x] كتابة اختبارات وحدات لكل مفتاح
- [x] تسجيل كل عملية مطابقة مع تفاصيل المصدر والهدف

### 3. إكمال منطق تصنيع Ending Inventory
- [x] تنفيذ القواعد المحددة لتحويل البيانات إلى قوائم E، F
- [x] تطبيق مفاتيح المطابقة مع حفظ أرقام السجل المتبادلة
- [x] ضمان تعديل الكميات بشكل آمن ومركزي

### 4. إضافة حماية صريحة ضد توليد تقارير بدون بيانات كافية
- [x] التأكد من توفر ملفات الإدخال الأربعة واجتياز التحقق من الصحة
- [x] التحقق من وجود الحقول المالية المطلوبة وصحتها
- [x] منع إنشاء تقارير مالية نهائية إذا لم تتوفر البيانات المطلوبة

## أولويات متوسطة (يجب تنفيذها قريباً)

### 5. استخدام نوع عدد دقيق (decimal) للمال وسياسة rounding موثقة
- [ ] استبدال الأرقام العائمة بمكتبة عددية دقيقة
- [ ] تطبيق سياسة rounding موثقة
- [ ] توثيق القواعد المستخدمة للتعامل مع المال

### 6. إضافة نظام تتبع أصول السجلات
- [x] تسجيل مصدر كل سجل/رقم الملف/رقم السجل القديم/الجديد
- [x] إنشاء سجل تدقيق يمكن الاستقصاء لاحقاً
- [x] ضمان عمليات ثنائية الاتجاه ومعدلة بشكل متناسق لجميع القوائم

### 7. بناء مجموعة اختبارات وحدات وتكامل شاملة
- [ ] اختبارات تغطي حالات اليتيم/سالب/صلاحية منتهية
- [ ] اختبارات تغطي المفاتيح العشرة للمطابقة
- [ ] اختبارات أداء مع ملفات Excel كبيرة

## أولويات منخفضة (يمكن تنفيذها لاحقاً)

### 8. تحسين الأداء على ملفات كبيرة
- [ ] استبدال عمليات البحث المتكررة باستخدام هياكل فهرسة
- [ ] استخدام معالجة مجزأة (chunking/streaming) للملفات الكبيرة
- [ ] تحسين خوارزميات المطابقة لتقليل التعقيد الزمني

### 9. تحسين واجهة المستخدم
- [ ] إضافة شريط بحث فوق كل جدول
- [ ] تنفيذ مؤشر التقدم عند العمليات الثقيلة
- [ ] إضافة زر طباعة مع معاينة طباعة احترافية
- [ ] تنفيذ وظائف التصدير المطلوبة

### 10. تحسين جودة الكود والتوثيق
- [ ] إضافة تعليقات عربية شاملة في الكود
- [ ] تطبيق فصل واضح بين UI، المنطق، والبيانات
- [ ] اتباع نمط تصميم منظم (مثل MVC)
- [ ] تنفيذ بنية معيارية تدعم التوسع

## أولويات إضافية

### 11. مهام إضافية
- [x] إصلاح مشكلة التقارير الفارغة بسبب عدم تطابق أسماء البيانات بين الواجهة الخلفية والأمامية
- [x] إصلاح مشكلة فهرسة الأعمدة في تقرير صافي المشتريات
- [x] تصحيح فهرسة الأعمدة بعد فحص هيكل البيانات الفعلية
- [ ] تحسين دقة الأرقام المالية والتقريب
- [ ] إنشاء اختبارات تلقائية للوظائف المحدثة
- [ ] إضافة دعم للغات المتعددة

## متابعة وتنفيذ

سيتم تنفيذ هذه الخطة تدريجياً مع إعطاء الأولوية للعناصر التي تؤثر على دقة النتائج المحاسبية أولاً، ثم تحسين واجهة المستخدم والوظائف الإضافية.